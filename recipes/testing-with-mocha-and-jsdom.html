<!doctype html>
<html class="no-js" lang="en-US">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Testing with mocha and jsdom ∙ Babel Starter Kit</title>
  <meta name="description" content="Knex Schema Reader is a utility for exporting a database schema to an object and/or json file">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" href="/knex-schema-reader/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:100,300,400,700italic">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <link rel="stylesheet" href="/knex-schema-reader/main.css">
</head>
<body>
  <div class="header">
  <div class="container">
    <a class="header__logo" href="/knex-schema-reader/">
      Knex Schema Reader
    </a>
        <span class="header__author">
          made with &nbsp;♥&nbsp; by&nbsp; <a href="https://twitter.com/mattjcowan" rel="author" title="Matt Cowan on Twitter">@mattjcowan</a>
        </span>
    
  </div>
</div>


  <div class="content">
    <div class="content-left">
      <div class="nav">
  <h3 class="nav__title">Quick Start</h3>
  <ul class="nav__menu">
    <li class="nav__menu-item">
      <a class="nav__link" href="/knex-schema-reader/">Overview</a>
    </li>
    <li class="nav__menu-item">
      <a class="nav__link" href="/knex-schema-reader/getting-started">Getting Started</a>
    </li>
  </ul>
  <!--
  <h3 class="nav__title">Recipes</h3>
  <ul class="nav__menu">
    <li class="nav__menu-item nav__menu-item--selected">
      <a class="nav__link" href="/knex-schema-reader/recipes/testing-with-mocha-and-jsdom">Testing with <code>mocha</code> and <code>jsdom</code></a>
    </li>
    <li class="nav__menu-item">
      <a class="nav__link" href="/knex-schema-reader/recipes/throwing-errors-with-fbjs-invariant">Throwing errors with <code>invariant</code></a>
    </li>
  </ul>
  -->
</div>

    </div>
    <div class="content-right">
      <h1>Testing with mocha and jsdom</h1>
<p>For browser-specific code, such as the one that relies on <code>document</code>, <code>window</code> global variables and
DOM manipulation, you may want to consider using <a href="https://github.com/tmpvar/jsdom">jsdom</a> library
that emulates browser environment, and in combination with <a href="https://github.com/rstacruz/mocha-jsdom">mocha-jsdom</a>,
can be fast and reliable tool for testing such type of code.</p>
<p>Let's see how it works on an example. Suppose you have a component that parses a URL string by
using <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/createElement">document.createElement</a>
method as follows:</p>
<h4><code>src/parseUrl.js</code></h4>
<pre><code class="language-js">function parseUrl(url) {
  const link = document.createElement('a');
  link.href = url;
  return {
    protocol: link.protocol,
    hostname: link.hostname,
    port: link.port,
    pathname: link.pathname,
    search: link.search,
    hash: link.hash,
    host: link.host
  };
}

export default parseUrl;
</code></pre>
<p>In order to create a unit test for this component, first we need to install <code>jsdom</code> and
<code>mocha-jsdom</code> npm modules by running:</p>
<pre><code class="language-sh">npm install jsdom mocha-jsdom --save-dev
</code></pre>
<p>Then create a unit test for the component above.</p>
<h4><code>test/parseUrlSpec.js</code></h4>
<pre><code class="language-js">import jsdom from 'mocha-jsdom';
import { expect } from 'chai';
import parseUrl from '../src/parseUrl';

describe('parseUrl', function() {

  jsdom(); // Emulates the browser environment

  it('should be able to parse a URL string', function() {
    const url = 'http://example.com:3000/pathname/?search=test#hash';
    const result = parseUrl(url);
    expect(result).to.be.deep.equal({
      protocol: 'http:',
      hostname: 'example.com',
      port: '3000',
      pathname: '/pathname/',
      search: '?search=test',
      hash: '#hash',
      host: 'example.com:3000'
    });
  });

});
</code></pre>
<p>Now when you run <code>npm test</code>, the unit test above should pass just fine, as if it was executed in a
browser.</p>

    </div>
  </div>
  <script
    src="https://code.jquery.com/jquery-2.2.4.min.js"
    integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
    crossorigin="anonymous"></script>
  <script src="/knex-schema-reader/main.js"></script>
</body>
</html>
